<!DOCTYPE html>
<html>
<head>
	<title></title>




<!-- Angular -->
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.js"></script>

<!-- Leaflet directive CAUTION on utilise pas le meme leaflet ici: J AI MODIFIIE LES SOURCES SUITE AU PB DE MARKER -->
<script src="{{url_for('static', filename='lib/leaflet/leaflet-src.js')}}"></script> 
<link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leaflet.css')}}" />
<script src="{{url_for('static', filename='lib/leaflet/angular-leaflet-directive.min.js')}}"></script>



  <!--  ui bootstrap -->
<script src="{{url_for('static', filename='lib/uibootstrap.min.js')}}"></script>


<!-- Jquery -->
	
		
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"
			  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
			  crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


<link rel="stylesheet" href="{{url_for('static', filename='css/main.css')}}" />

</head>
<body>
 {% include 'navbar.html' %}
<div ng-app="app" class="container-fluid">

        <div ng-controller="headerCtrl">
		
			<div class="col-sm-3"> 
				<div class="panel panel-default">
					<div class="section">
						<form name="addObsForm" ng-submit="onSubmit(view, addObsForm)" novalidate>
							<div class="form-group">
							    <div class="btn-group">
			        				<label class="btn btn-success" ng-model="view" uib-btn-radio="'flore'" uncheckable>Flore</label>
			        				<label class="btn btn-success" ng-model="view" uib-btn-radio="'faune'" uncheckable>Faune</label>
			  					</div>
			  				</div>
			  				<div class="form-group" ng-class="{'has-error' : addObsForm.observateur.$invalid && !addObsForm.observateur.$pristine  || (validationAttempt && addObsForm.observateur.$invalid)}">
								<input class="form-control" type="text" name="observateur" placeholder="Observateur: NOM PRENON - en majuscule" ng-model="globalForm.observateur" required>
								<p ng-show="(addObsForm.observateur.$invalid && !addObsForm.observateur.$pristine) || (validationAttempt && addObsForm.observateur.$invalid) " class="help-block">Le nom de l'observateur est requis</p>
							</div>


							<div class="form-group" >
						 		<input name = "nom_vern" id="input_nomvern" autocomplete="off" placeholder="Nom vernaculaire " type="text" ng-model="globalForm.taxon" typeahead-editable="false"  uib-typeahead="taxon as taxon.nom_vern for taxon in search_vern_name($viewValue, view)"  | limitTo:8" class="form-control" typeahead-min-length="2" typeahead-no-results="noResults" typeahead-loading="isLoading">
						 	</div>
						
							<div class="form-group" ng-class="{'has-error' : addObsForm.lb_nom.$invalid && !addObsForm.lb_nom.$pristine  || (validationAttempt && addObsForm.lb_nom.$invalid) }">
							 	<input name="lb_nom" autocomplete="off" placeholder="Nom scientifique " type="text" ng-model="globalForm.taxon" typeahead-editable="false"  uib-typeahead="taxon as taxon.lb_nom for taxon in search_scientist_name($viewValue, view)"  | limitTo:8" class="form-control" typeahead-min-length="2" typeahead-no-results="noResults" typeahead-loading="isLoading" required>
							 	<p ng-show="(addObsForm.lb_nom.$invalid && !addObsForm.lb_nom.$pristine) || (validationAttempt && addObsForm.lb_nom.$invalid)" class="help-block">Le nom scientifique est requis</p>
							</div>

							    <div class="form-group" >
					                <div class='input-group date' id='datetimepicker1' ng-class="{'has-error' : addObsForm.date.$invalid && !addObsForm.date.$pristine || (validationAttempt && addObsForm.date.$invalid) }">
					                    <input  id="firstDate" name="date" placeholder="Date de l'observation" type="text" class="form-control" uib-datepicker-popup="{{format}}" ng-model="globalForm.date"" is-open="isOpen" datepicker-options="dateOptions"  close-text="Close" alt-input-formats="altInputFormats" required ng-click="openDate()" />
					                    <span class="input-group-addon">
					                        <span style="cursor: pointer;" class="glyphicon glyphicon-calendar" ng-click="openDate()"></span>
					                    </span>
					                </div>
					                <p style="color: #a94442;"  ng-show="addObsForm.date.$invalid && !addObsForm.date.$pristine || (validationAttempt && addObsForm.date.$invalid)" class="help-block" >Le date est requise</p>
					            </div>


							      
							  
							  <div ng-show="showCoord" class="form-group">
								  <label> Coordonnées  </label>
								  <input class="form-control" type="number" step="0.001" name="" placeholder="X" ng-model="markers.main.lng" ng-change="changeLng()" >
								  <input class="form-control" type="number" step="0.001" placeholder="Y" ng-model="markers.main.lat" ng-change="changeLat()">
							  </div>

							  <label> Champs facultatifs  </label>
							  <input class="form-control" type="text" placeholder="Commentaire" ng-model="globalForm.commentaire"  >


							  <!-- FLORE -->

							  <div ng-if="view == 'flore' ">
								  <div class="form-group" >
								  	<input class="form-control" type="text" placeholder="Nombre de pied exact"  ng-model="formFlore.nb_pied_exact" >
								  	<select class="form-control" type="text" placeholder="Abondance" ng-model="formFlore.abondance" ng-options="choice as choice for choice in abondance" >
								  		<option value=""> - Abondance - </option>
								  	</select>
								  	
								  	<select class="form-control" type="text" ng-model="formFlore.nb_pied_approx" ng-options="choice as choice for choice in nb_pied_approx">
								  		<option value=""> - Nombre de pied approximattif -</option>
								  	</select>
								  </div>
								  <div class="form-group">
								  	<select class="form-control" type="text" placeholder="Stade de développement" ng-model="formFlore.stade_dev" ng-options="choice as choice for choice in stade_dev">
								  		<option value=""> - Stade de développement - </option>
								  	</select>
								  </div>
							  </div>


							  <!-- FAUNE -->
							  <div ng-if="view == 'faune'">
								  <div class="form-group" >
								  	<select class="form-control" type="text" placeholder="Type d'observation" ng-model="formFaune.type_obs" ng-options="choice as choice for choice in type_obs" >
								  		<option value=""> - Type d'observation - </option>
								  	</select>
								  	<select class="form-control" type="text" placeholder="Traces" ng-model="formFaune.comportement" ng-options="choice as choice for choice in comportement">
								  		<option value=""> - Comportement - </option> 
								  	</select>
								  	<select class="form-control" type="text" placeholder="Traces" ng-model="formFaune.trace" ng-options="choice as choice for choice in trace">
								  		<option value=""> - Trace - </option> 
								  	</select>
								  	<select class="form-control" type="text" placeholder="Effectif" ng-model="formFaune.effectif" ng-options="choice as choice for choice in effectif" >
								  		<option value=""> - Effectif - </option>
								  	</select>
								 </div>

<!-- 								  	<div class="form-group" ng-class="{'has-error' : addObsForm.nb_individu.$invalid && !addObsForm.nb_individu.$pristine  || (validationAttempt && addObsForm.nb_individu.$invalid)}">
								  		<input class="form-control" type="number" placeholder="Nombre d'individu" ng-model="formFaune.nb_individu"  name="nb_individu">
								  		<p ng-show="(addObsForm.nb_individu.$invalid && !addObsForm.nb_individu.$pristine) || (validationAttempt && addObsForm.nb_individu.$invalid) " class="help-block">Ce champs doit être un entier</p>
								  	</div>
								  	<div class="form-group" ng-class="{'has-error' : addObsForm.nb_male.$invalid && !addObsForm.nb_male.$pristine  || (validationAttempt && addObsForm.nb_male.$invalid)}">
								  		<input class="form-control" type="number" placeholder="Nombre de mâle adulte" ng-model="formFaune.nb_male"  name ="nb_male">
								  		<p ng-show="(addObsForm.nb_male.$invalid && !addObsForm.nb_male.$pristine) || (validationAttempt && addObsForm.nb_male.$invalid) " class="help-block">Ce champs doit être un entier</p>
								  	</div>
								  	<div class="form-group" ng-class="{'has-error' : addObsForm.nb_femelle.$invalid && !addObsForm.nb_femelle.$pristine  || (validationAttempt && addObsForm.nb_femelle.$invalid)}">
								  		<input class="form-control" type="number" placeholder="Nombre de femelles adulte" ng-model="formFaune.nb_femelle"  name="nb_femelle">
								  		<p ng-show="(addObsForm.nb_femelle.$invalid && !addObsForm.nb_femelle.$pristine) || (validationAttempt && addObsForm.nb_femelle.$invalid) " class="help-block">Ce champs doit être un entier</p>
								  	</div>
								  	<div class="form-group" ng-class="{'has-error' : addObsForm.nb_jeune.$invalid && !addObsForm.nb_jeune.$pristine  || (validationAttempt && addObsForm.nb_jeune.$invalid)}">
								  		<input class="form-control" type="number" placeholder="Nombre de jeune" ng-model="formFaune.nb_jeune"  name = "nb_jeune">
								  		<p ng-show="(addObsForm.nb_jeune.$invalid && !addObsForm.nb_jeune.$pristine) || (validationAttempt && addObsForm.nb_jeune.$invalid) " class="help-block">Ce champs doit être un entier</p>
								  	</div>
								  	<div class="form-group" ng-class="{'has-error' : addObsForm.nb_non_identifie.$invalid && !addObsForm.nb_non_identifie.$pristine  || (validationAttempt && addObsForm.nb_non_identifie.$invalid)}">
								  		<input class="form-control" type="number" placeholder="Nombre non identifié" ng-model="formFaune.nb_non_identifie"  name="nb_non_identifie">
								  		<p ng-show="(addObsForm.nb_non_identifie.$invalid && !addObsForm.nb_non_identifie.$pristine) || (validationAttempt && addObsForm.nb_non_identifie.$invalid) " class="help-block">Ce champs doit être un entier</p>
								  	</div> -->


								  	<div class="form-group">
									    <div class="col-sm-6 no-padding" ng-class="{'has-error' : addObsForm.nb_individu.$invalid && !addObsForm.nb_individu.$pristine  || (validationAttempt && addObsForm.nb_individu.$invalid)}"">
									        <input class="form-control" type="number" placeholder="Nombre d'individu" ng-model="formFaune.nb_individu"  name="nb_individu">
									    </div>
									    <div class="col-sm-6 no-padding" ng-class="{'has-error' : addObsForm.nb_male.$invalid && !addObsForm.nb_male.$pristine  || (validationAttempt && addObsForm.nb_male.$invalid)}">
									        <input class="form-control" type="number" placeholder="Nombre de mâle adulte" ng-model="formFaune.nb_male"  name ="nb_male">
									    </div>
									</div>
								  	<div class="form-group">
									  	<div class="col-sm-6 no-padding" ng-class="{'has-error' : addObsForm.nb_femelle.$invalid && !addObsForm.nb_femelle.$pristine  || (validationAttempt && addObsForm.nb_femelle.$invalid)}">
									  		<input class="form-control" type="number" placeholder="Nombre de femelles adulte" ng-model="formFaune.nb_femelle"  name="nb_femelle">
									  	</div>
									  	<div class="col-sm-6 no-padding" ng-class="{'has-error' : addObsForm.nb_jeune.$invalid && !addObsForm.nb_jeune.$pristine  || (validationAttempt && addObsForm.nb_jeune.$invalid)}">
									  		<input class="form-control" type="number" placeholder="Nombre de jeune" ng-model="formFaune.nb_jeune"  name = "nb_jeune">
									  	</div>
									</div>
									<div class="form-group" ng-class="{'has-error' : addObsForm.nb_non_identifie.$invalid && !addObsForm.nb_non_identifie.$pristine  || (validationAttempt && addObsForm.nb_non_identifie.$invalid)}">
								  		<input class="form-control" type="number" placeholder="Nombre non identifié" ng-model="formFaune.nb_non_identifie"  name="nb_non_identifie">
								  	</div>

								  	
							</div>

							<input class="btn btn-success" type="submit">
							<div ng-show="formSuccessfullySent" class="alert alert-success">Observation enregistrée avec succès</div>
						</form>

						<div class="row" style="height: 10px;"></div>
											
					</div>
				</div>
				
			</div>

			<div class="col-sm-9">
					<leaflet lf-center='center'  height="85vh" markers="markers" geojson=geojsonMaille></leaflet>

					<button class="btn btn-success" ng-click="switchMaille()" ng-class="{'disabled': geojsonMaille.data != undefined }"> Mode maille</button>
					 <button ng-click="switchPoint()" class="btn btn-success" ng-class="{'disabled': markers.main != undefined }"> Mode point</button>	
			</div>

  </div>
		</div>


</div> 





</body>

<script type="text/javascript"> var URL_APPLICATION = {{URL_APPLICATION|tojson}} </script>
<script src="{{url_for('addObs.static', filename='addObs.js')}}"></script>
</html>